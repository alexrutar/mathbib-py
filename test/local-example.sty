% biblatex
% --------
\RequirePackage[
    backend=biber,
    giveninits=true,
    natbib=true,
    style=alphabetic,
    backref=false,
    doi=false,
    isbn=false,
    url=false,
    date=year
    ]{biblatex}

% bold volume number; plain pages
\DeclareFieldFormat[article]{volume}{\mkbibbold{#1}}
\DeclareFieldFormat{pages}{#1}
\DeclareFieldFormat{journaltitle}{#1}

% italicsed title
\DeclareFieldFormat
  [article,preprint,inbook,incollection,inproceedings,thesis]
  {title}{\mkbibemph{#1\isdot}}

% custom formatting for preprints (with and without journal)
\newbibmacro*{preprint:journal}{\iffieldundef{journaltitle}{\printtext{Preprint}}{\printtext{To appear in:}\addspace\printfield{journaltitle}\newunit}}

% short journal name and volume (suppress number)
\newbibmacro*{journalshort}{%
  \usebibmacro{journal}%
  \setunit*{\addspace}%
  \printfield{volume}
  \setunit{\addspace}%
  \usebibmacro{issue+date}%
  \newunit}

\DeclareFieldFormat[preprint]{labelalpha}{#1+} % change formatting for manuscript

% eprint / archive
% define new eprinttype using e.g. `eprint:jstor` (see below for pattern)
\newbibmacro{archive}{\iffieldundef{eprinttype}
  {\printfield{eprint}}
  {\printfield[eprint:\strfield{eprinttype}]{eprint}}
}
\DeclareFieldFormat{eprint:arxiv}{\href{https://arxiv.org/abs/#1}{\nolinkurl{arxiv:#1}}}
\DeclareFieldFormat{eprint:zbl}{\href{https://zbmath.org/#1}{\nolinkurl{zbl:#1}}}
\DeclareFieldFormat{eprint:mr}{\href{https://mathscinet.ams.org/mathscinet-getitem?mr=#1}{\nolinkurl{MR#1}}}

% main drivers

\DeclareBibliographyDriver{preprint}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/translator+others}%
  \setunit{\printdelim{nametitledelim}}\newblock
  \usebibmacro{title}%
  \newunit\newblock
  \usebibmacro{preprint:journal}%
  \newunit\newblock
  \usebibmacro{archive}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \usebibmacro{finentry}}

\DeclareBibliographyDriver{article}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/translator+others}%
  \setunit{\printdelim{nametitledelim}}\newblock
  \usebibmacro{title}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \usebibmacro{journalshort}
  \newunit
  \usebibmacro{note+pages}%
  \usebibmacro{archive}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \usebibmacro{finentry}}


% hyperref
% --------
\RequirePackage[bookmarks=true,hidelinks]{hyperref}
\RequirePackage{bookmark}
\RequirePackage{xcolor}
\newcommand\myshade{85}
\colorlet{mylinkcolor}{violet}
\colorlet{mycitecolor}{orange!50!yellow}
\colorlet{myurlcolor}{green!50!blue}

\hypersetup{
    linkcolor  = mylinkcolor!\myshade!black,
    citecolor  = mycitecolor!\myshade!black,
    urlcolor   = myurlcolor!\myshade!black,
    colorlinks = true,
}

% cleveref
% --------
\RequirePackage[capitalise,nameinlink]{cleveref}
\crefformat{equation}{(#2#1#3)} % equations are referenced like (1.2)
\crefformat{figure}{#2Figure #1#3} % figures are referenced like Figure 3 (not sure why the default is to use Fig.?)
\newenvironment{proofref}[1]{\begin{proof}[of \cref{#1}]}{\end{proof}}

% Format references
\crefformat{equation}{(#2#1#3)}
\Crefformat{theorem}{#2Thm. #1#3}
\Crefformat{lemma}{#2Lem. #1#3}
\Crefformat{proposition}{#2Prop. #1#3}
\Crefformat{corollary}{#2Cor. #1#3}
\crefformat{theorem}{#2Theorem #1#3}
\crefformat{lemma}{#2Lemma #1#3}
\crefformat{proposition}{#2Proposition #1#3}
\crefformat{corollary}{#2Corollary #1#3}
\crefformat{claim}{#2Claim #1#3}
\Crefformat{claim}{#2Cl. #1#3}

